<?php
$memory_limit = substr(ini_get("memory_limit"), 0,-1);
if($memory_limit<256){
  ini_set("memory_limit","256M");
}

global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24;
$x0b="ar\x72a\171\x5f\x6be\171\x73"; $x0c="\141\x72\x72a\171_\x6de\x72\x67\x65"; $x0d="\143o\x75\156\x74"; $x0e="d\x61\164e"; $x0f="\x65\x78\x70l\157\144\x65"; $x10="f\x69\x6c\x65_\x65x\x69s\164s"; $x11="\x66\151l\x65s\151\172\x65"; $x12="ht\x6d\x6c\x65n\x74\151\x74\151\x65s"; $x13="h\x74m\154\x5fenti\x74y_\x64e\143\x6f\x64e"; $x14="\151\x6d\160lo\x64e"; $x15="\x69n\137\141\x72\162\x61\x79"; $x16="\151\x6e\151\x5fse\x74"; $x17="i\x73_\x6e\x75\155\145\162ic"; $x18="\x6e\x6c2\142\162"; $x19="n\x75\155\142e\x72_fo\x72\155\141\x74"; $x1a="\162\x6fu\156\x64"; $x1b="\162\x74r\x69m"; $x1c="\x73\x74r\x5fre\x70l\141\x63\145"; $x1d="\x73\x74r\137irep\x6cac\145"; $x1e="\x73\164r\151\x70\x5ft\141gs"; $x1f="s\x74r\x69\160\x73\154a\163he\x73"; $x20="\163\164\162\164\x6fu\160\160\x65\162"; $x21="\x73\164rp\157\x73"; $x22="\163u\142s\164\162"; $x23="\163t\x72\x74o\x6co\167\x65\x72"; $x24="t\162\151\155"; 
class PDFContent {private $templateid;private $module;private $language;private $focus;private $db;private $mod_strings; private $app_strings;private $decimal_point;private $thousands_separator;private $decimals;private $pagebreak;private $ignored_picklist_values=array();private $header;private $footer;private $body;private $content;private $filename;private $templatename;private $section_sep="&\x23\x25ITS%%\045@@\100%\x25\x25IT\x53\045\043&";private $replacements;private $inventory_table_array = Array("P\x75r\x63h\141s\x65\x4f\x72\x64\145r"=>"\x76\x74\151\147e\162_\x70\165\162\143ha\163e\157\x72\144\x65\162", "\123\141\x6c\x65s\x4f\162\x64\x65r"=>"\x76\x74\151\147\x65\x72_sa\154e\x73\157\x72d\x65r", "\121\165\x6ft\145s"=>"\x76\164i\147\145\162\x5fq\x75\157\164e\163", "\x49nv\x6f\151c\x65"=>"\x76\164\x69\x67\x65\162_\x69\x6e\166\157\151\143\145");private $inventory_id_array = Array("P\x75\x72\143\150\x61\163eO\162\x64e\162"=>"p\x75rc\150a\x73\145\157\162d\145\x72\151d","\123\x61\154es\x4f\x72\x64e\x72"=>"\163\x61\x6c\x65\x73\157\x72\x64\145\x72\x69\x64","Q\165\157\164e\x73"=>"quo\x74e\x69\x64","\x49\156voic\145"=>"i\156\x76o\151\143\x65\x69\x64");private $org_cols = array("\x6fr\x67\141ni\x7a\x61\x74\x69\157nn\141\155\x65" => "\x43\x4f\x4dP\x41NY\x5fN\101\115\x45","\x61d\144re\x73s" => "\103\117\x4dP\x41N\x59\137\x41\x44\x44\x52\105SS","c\151\x74y" => "\103\x4f\x4d\120\101N\131\137CI\124\131","\x73\164\141\x74\x65" => "\x43\x4fMPA\x4e\x59_\123T\x41\x54\105","c\157\144\145" => "C\x4f\x4d\120\101NY\137Z\x49P","c\157\165\156\164\x72\171" => "\103O\x4d\x50\x41\x4e\x59\137C\117\x55\116\124\x52\131","\160h\157n\x65" => "CO\x4d\x50\x41\x4eY_P\110\117\116\105","\x66a\x78" => "CO\115\120\x41N\131_F\101\x58","\167\x65\142s\151\x74\145" => "\103\117M\x50\101\x4e\131\137\127EB\x53\x49\124E","\154\157g\x6f" => "\x43\x4f\x4d\120A\x4e\131\x5f\114\x4fG\117", );function __construct($templateid, $module, $focus, $language) {$db = "\141\144\x62";$mod = "\155o\x64\x5f\x73\x74ri\156g\x73";$app = "\141pp\137\x73\164\162\151n\x67\x73";global $$db, $$mod, $$app, $PDFMaker_template_id;$this->db = &$$db;$this->mod_strings = $$mod; $this->app_strings = $$app;$this->templateid = $templateid;$PDFMaker_template_id = $this->templateid;$this->module = $module;$this->focus = $focus;$this->language = $language;$this->x13();$this->x14();}public function getContent() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $img_root = "\x69\x6d\147\137\162\157\x6ft_\144\x69re\x63\164o\x72\171";global $$img_root;$this->content = $this->body;$this->content = $this->header.$this->section_sep;$this->content .= $this->body.$this->section_sep;$this->content .= $this->footer;$this->replacements["&\156bs\160\073"]=" ";$this->replacements["\043\x23\120A\x47\105\043#"]="\x7b\x50\101\107E\116O\x7d";$this->replacements["#\x23\120\101GES#\x23"]="{nb}";$this->replacements["#\x23D\x44-\115\x4d\055\x59\x59\131Y\x23\x23"]=$x0e("\144-m\x2dY");$this->replacements["\043#D\104\x2e\115\115.\131YYY\043\043"]=$x0e("\x64\x2e\x6d\056Y");$this->replacements["\043#\115M\x2dD\104-\131\x59YY\x23\043"]=$x0e("\155-d\x2d\x59");$this->replacements["\x23\x23\x59\131\x59Y\x2dM\x4d\x2d\x44\x44\043\x23"]=$x0e("\x59\x2d\155\x2d\144");$this->replacements["\x73r\143=\x27"]="\163\x72\143='".$$img_root;$this->replacements["\044".$x20($this->module)."_CR\115\111\x44$"]=$this->focus->id;$double_quote='"';$this->replacements[$x12('<div style='.$double_quote.'page-break-after: always;'.$double_quote.'>
	<span style='.$double_quote.'display: none;'.$double_quote.'>&nbsp;</span></div>')] = $this->pagebreak; $this->replacements[$x12('<div style='.$double_quote.'page-break-after: always;'.$double_quote.'><span style='.$double_quote.'display: none;'.$double_quote.'>&nbsp;</span></div>')] = $this->pagebreak; $this->x12();$this->content = $x13($this->content); $this->x0b();$this->x0e($this->module, $this->focus);$this->x0d();if($this->focus->column_fields["\x61s\x73\x69\147\156ed\137\x75\163\x65\x72\137id"]==""){$this->focus->column_fields["\x61\x73s\151\147n\x65\x64\x5f\165\163e\162\x5fi\x64"]=$this->db->query_result($this->db->query("\x53E\114E\103\124 \x73\x6d\157\167n\145r\x69\144 \106\122\x4f\x4d \166ti\147e\162\137\x63r\155e\156\164it\x79\x20\x57\x48\105\122E\040c\x72\155\151\x64\x3d".$this->focus->id),0,"\x73\155\157w\x6e\145\162\x69d");}$this->x0f();$this->x10();$this->x11();$PDF_content = array();list($PDF_content["\150e\141\x64\145\x72"],$PDF_content["b\x6f\144\171"],$PDF_content["f\x6f\157\x74\145\162"]) = $x0f($this->section_sep,$this->content);return $PDF_content;}public function getSettings() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $sql = "\x53E\x4c\x45\x43\124 \050\x6da\x72\147\x69\156_\164\157\160\040\x2a\040\x310)\040\101S\x20\x6d\x61\x72\x67\x69\156\137to\160,\015\012\040\040\x20   \x20  \040 \x20\040\x20  \040\x20\040\x20\x20\x28ma\162\x67\151\x6e\137\142\157tt\157\x6d\x20\052\x20\x31\060\x29\040\101S\040m\x61rg\151n\137bot\164\157m,\015\x0a\x20\040\040\x20 \040\x20 \x20 \040\x20\040\x20 \x20  \040\x20\040(m\x61\x72\x67\x69\156\137\x6c\x65\146t \052\04010)\x20A\123\x20\155a\162\x67\x69n_\x6c\145\x66\x74,
\012\x20 \040\x20\040  \x20\x20\040\040  \040\040  \x20   \050\155\x61r\x67i\156\137\162i\147ht\0521\060\x29 \x41S\040m\141r\x67i\156\x5frig\x68\164,
\012   \x20  \040\x20\040\040\040\040 \x20\040\x20 \x20\x20\x20 \x66orm\x61\x74,
\012\040 \x20 \040 \040 \040\040\040\040\x20\x20   \x20\040\x20\x20\157r\151e\156\164a\x74\151\x6f\156\x2c\015
 \x20 \x20 \040\040\x20   \x20\040\x20\040\x20     \x65\x6e\x63o\x64\151n\147\015\x0a\x20\040\040\x20\x20 \040    \040 \x20\x46ROM\040v\164i\147\x65\162\x5fp\144\146\155\x61\153\145r\137\163e\x74\x74\x69\x6e\147\163 WHER\x45\x20\164e\x6d\x70\x6ca\164\145\151d\040\075\040'".$this->templateid."'";$result = $this->db->query($sql);$Settings = $this->db->fetchByAssoc($result, 1);return $Settings;}private function x0b() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $sql = "\123\105L\105\x43\x54 f\151\x65\x6c\144\151\144\x2c\x20fiel\144\x6e\141\155\145\054\x20\165i\x74y\x70\x65\x0d
 \040\040\x20\x20  \040\x20 \x20\040 \x20\x46\122O\115\040\166ti\147er\137\x66ie\154d\x0d\x0a\040 \x20\040 \040\x20\040\x20 \x20   \127\110E\x52\105 t\x61\142i\x64\x3d".getTabId($this->module)."\040A\116\x44\040\x28\144\x69\163p\x6c\x61\x79\164\x79\x70e !\075\x20\x33\x20\117\122\040f\x69eld\151\x64 =\040\x36\x34\x29 \x41ND\x20\146\151\145\x6c\x64\151\144 \041\075 1\x305";$result = $this->db->query($sql);$num_rows = $this->db->num_rows($result);if ($num_rows > 0){while($row = $this->db->fetch_array($result)){$related_module = "";$fk_record = $this->focus->column_fields[$row["\x66\x69\x65\154\144n\141\x6de"]];switch ($row["\165\x69\164\171\160\145"]) {case "\x35\x31": $related_module = "\x41cco\165\156\164\x73"; break;case "\065\067": $related_module = "Co\x6e\x74\141\143ts"; break;case "5\x38": $related_module = "C\141\155p\x61\151\x67\x6e\163"; break;case "\0659": $related_module = "Pr\157\x64\165\143\x74\x73"; break;case "\x373": $related_module = "\101\x63\143\157\165\x6et\x73"; break;case "75": $related_module = "\126\x65\x6e\x64o\162\163"; break;case "\x381": $related_module = "\x56\x65\x6edo\162s"; break;case "7\x36": $related_module = "P\157t\x65\x6et\151\x61\x6cs"; break;case "\x37\x38": $related_module = "Qu\157\164\145s"; break;case "8\x30": $related_module = "S\x61l\145\x73\x4f\162de\x72"; break;case "\0668":case "1\x30": $related_module = getSalesEntityType($fk_record); break;}if ($related_module != "") {$tabid = getTabId($related_module);$field_inf = "\x5f\x66i\145\154\x64i\x6ef\157\137\x63a\x63h\145";$temp = &VTCacheUtils::$$field_inf;unset($temp[$tabid]);$focus2 = CRMEntity::getInstance($related_module);if ($fk_record != "" && $fk_record != "\x30") {$result_delete = $this->db->query("\123E\x4c\105\103\124\x20\144\145\x6c\145\164\x65\144\x20\x46RO\x4d \x76\164i\147e\162\x5f\143\162\155\x65\156t\x69t\171\040\x57\110\x45R\105\040\x63\x72m\x69d='".$fk_record."'\040\x41N\104\040\x64\145\154\145\x74\145\x64=0");if($this->db->num_rows($result_delete)>0){$focus2->retrieve_entity_info($fk_record,$related_module); $focus2->id = $fk_record;}}$this->replacements["$"."\122\137".$x20($related_module)."\x5fC\x52M\111\104\x24"]=$focus2->id;$this->x0e($related_module, $focus2, true);unset($focus2);}if ($row["\165\151\164\x79\x70\x65"] == "1\060" || $row["u\x69\164\171\x70\145"] == "\066\x38") {if ($related_module == "A\x63\143\x6f\165\x6e\x74\163")$related_module2 = "\103\157\156\x74a\x63t\x73";else$related_module2 = "\101cc\157\x75\x6ets";$tabid2 = getTabId($related_module2);$field_inf = "_\x66\151\x65\154d\151\x6ef\157_\x63\141\143he";$temp = &VTCacheUtils::$$field_inf;unset($temp[$tabid2]);$focus3 = CRMEntity::getInstance($related_module2);$this->replacements["\x24"."\x52_".$x20($related_module2)."_\103RM\x49\104\044"]=$focus3->id;$this->x0e($related_module2, $focus3, true);unset($focus3);}}}}private function x0c() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; require_once("\143\154\x61\163s\145s\057\163\151mp\154e_\150\x74\155l_\144o\155\056ph\160");$html = str_get_html($this->content);$tableDOM=false;foreach($html->find("t\144") as $td){if($x24($td->plaintext) == "#\x50\x52\117DU\x43\x54\x42\114\x4f\103_\x53\x54\101\122T#"){ $td->parent->outertext = "\043\120\122\117\x44UCT\x42\114\117C_S\124\101\x52\x54\043"; list($tag)=$x0f(">",$td->parent->parent->parent->outertext,2); $tag.="\x3e"; $header = $td->parent->prev_sibling()->outertext; $var = $td->parent->next_sibling()->last_child()->plaintext; $subtotal_tr=""; if($x21($var, "TOTA\x4c")!==false) $subtotal_tr="<\164\162\076\x3c\x74\x64\x20\x63o\x6c\x73\160\x61\156='".($td->getAttribute("\x63o\154\163p\141\x6e")-1)."'>%\107\137\x53\x75b\x74ota\x6c\x25\074/\x74\x64>\074\x74\144\x20\141\154i\147n='\x72i\147\150\164'\x3e".$x1b($var,"$")."\137\x53U\102\x54\x4f\x54\101L$\x3c/\164\144\x3e\074/\164\x72\x3e"; $tableDOM["\164\x61g"] = $tag; $tableDOM["\150\x65\141\144\145\x72"] = $header; $tableDOM["\x73ubt\157\x74a\x6c"] = $subtotal_tr;}if($x24($td->plaintext) == "#\120RO\x44\x55\103\124\x42\114\x4fC\137\105\x4eD\x23") $td->parent->outertext = "\043\120\x52O\x44U\x43\x54B\114OC\137\105\116\104\043";}$this->content=$html->save();return $tableDOM;}private function x0d() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; if ($this->module == "Q\x75\x6f\x74es" || $this->module == "\111\x6e\166o\151\x63\145" || $this->module == "S\141\154\x65\x73O\162\144er" || $this->module == "P\x75\x72cha\x73\145\117r\x64\x65\x72"){$this->replacements["\x24"."\123\125\x42\x54\x4f\124\101\x4c\044"] = $this->x1d($this->focus->column_fields["\x68dn\x53\x75\142\x54\157ta\x6c"]);$this->replacements["$"."\124\117\124\101\x4c\x24"] = $this->x1d($this->focus->column_fields["\150\144nGra\156\144\124\157t\141\154"]);$currencytype = $this->x1b();$currencytype["cu\162\162\145n\143\x79_\x73\x79\155\142ol"] = $x1c("\200","\046\x65u\162\157\073",$currencytype["\143\165\162r\x65n\x63\x79_\163y\x6d\142\x6fl"]);$currencytype["\143u\x72r\x65n\143y\137s\x79\155b\x6f\154"] = $x1c("\xa3","\046\x70\157u\156d;",$currencytype["\x63u\162r\145\156\x63\x79\x5f\x73y\155bo\154"]);$this->replacements["\044"."\103\125RR\x45\x4e\103\x59\116A\115E\044"] = getTranslatedCurrencyString($currencytype["\x63\165\x72ren\143\171\x5f\x6e\141\x6d\145"]);$this->replacements["\044"."CU\x52\122\105NC\x59\x53\x59\x4dB\x4fL\044"] = $currencytype["c\165\x72ren\x63\171\137s\171\155\142\157\x6c"];$this->replacements["\044"."CUR\122\x45\116CY\103\117\104E\x24"] = $currencytype["c\x75r\x72\x65\x6e\x63\x79_c\x6f\144e"];$this->replacements["$"."\101\104\x4a\x55\x53\x54\115\105N\x54\044"] = $this->x1d($this->focus->column_fields["tx\x74\x41dj\x75\163\164m\145\156\x74"]);$Products = $this->x15();$this->replacements["\044"."T\117\x54\101\x4cWIT\x48\x4f\x55TVA\124\x24"] = $Products["\x54\x4f\x54A\x4c"]["TOT\x41L\x57\111\124\110OUT\x56\x41\x54"];$this->replacements["\x24"."\x56\x41T\x24"] = $Products["\x54O\x54AL"]["T\101\130\124O\124\101\114"];$this->replacements["\044"."\126\x41T\120\x45RCE\x4eT\x24"] = $Products["\x54\x4f\x54\x41L"]["\124\x41\130T\x4f\124A\x4c\120\105\122\x43\105NT"];if ($x0d($Products["\124OT\101\x4c"]["\x56\x41\124\x42\x4c\x4f\x43\113"]) > 0){ $vattable = "\074\164\141\x62\154e\x20b\157\162\144\x65\162\x3d'\061'\040s\164\171l\x65\075\"\142o\162\x64\145\162\055coll\x61\160s\x65:c\157l\x6c\141\160\x73\145\073\"\040\143\145\154\154\160a\144di\x6e\147\075\"\063\"\076"; $vattable .= "<\164\x72\076\x0d\012\x09 \040\040\x20\040\x20\x20\040 \x20\040\040\x20\040\x20\x20  \x20\040 \x20\x20 \074t\144 \156\x6f\167\x72a\160\x20a\x6c\x69\147\156\x3d'\x63e\x6e\x74\x65\x72'\076".$this->app_strings["\116\x61me"]."\074/\x74\144>\015
\011\x09		\011	\x09\x3ct\x64 now\162\141\160\040\141l\x69\x67n\075'\143\145\x6eter'>".$this->mod_strings["L\x42\x4c\137\x56\x41T\102\x4cO\x43K_V\x41\124_\120\105\x52CEN\x54"]."</td\076\015\x0a\x09\040\x20\040\040\x20\040\x20\040\x20\040\040\x20 \040 \x20\x20 \x20\040\x20 \x20\040<td n\157wr\x61\x70\040\x61\154\151gn\075'\x63en\164\145r'>".$this->mod_strings["\x4cB\x4c\x5f\x56A\124\102\114O\103\113\137S\x55M"]."\x20(".$currencytype["\x63ur\x72\145n\143\171_s\171\155\142o\x6c"].")"."<\x2ft\x64\076
\012	 \040 \040  \x20\x20 \x20\040\x20 \040\040 \040\x20\x20\040\040  \040<\164\144 n\x6fw\x72\141p\040ali\147\x6e='\143\x65\156\x74er'>".$this->mod_strings["\x4c\x42\x4c_\126AT\x42\114\x4fC\113\x5f\126\101T_\126A\114U\x45"]."\040\050".$currencytype["\x63\x75\162\x72\145n\143\x79_\163y\155b\157l"].")"."\x3c\x2f\x74d\x3e\x0d\012\x09\040 \x20\040  \040\x20\x20\x20  \x20\x20\x20 \x20\040\x20  \040\074\x2ft\162\076"; foreach ($Products["TO\x54\101\x4c"]["\x56A\124\x42\x4c\x4f\x43\113"] as $keyW=>$valueW) { if($valueW["ne\x74\x74o"]!=0) { $vattable .= "\074\x74\162\076\015\012\x09\040\x20\x20\x20\x20\x20\040\040\040 \040\040\x20\x20\x20 \040\040  \x20\x20 \040  \040 \074td\x20\x6e\157w\162\141p \141li\147\156\075'l\x65\146t'\x20\167i\144\x74h\x3d'20\x25'>".$keyW."<\057\164\x64\076\015
\011	\x09\x09\011\x09\011\x09<\x74d\040n\157w\162ap\040\x61lign\075'ri\x67\x68\x74' \167\151d\x74\x68='\x32\065%'\x3e".$this->x1d($valueW["\166a\154\x75e"])." %<\057t\x64>\015\x0a	\x20\x20\x20\x20\040\x20\x20\x20\x20\x20\x20  \x20\x20\040\x20 \x20\040\040\040 \x20\040\040\040\x20<\x74d \156\157\x77\162\x61\160 \141\154i\x67\x6e\x3d'r\x69\147\x68t' wi\144\164h\075'30%'>".$this->x1d($valueW["\156etto"])."\074\057\164d>\015
\011 \x20 \x20  \040\x20\040\040\x20\x20\040\x20\040 \040\040\040\040\040\x20\040\040\x20\x20\x20\040<\164\144\x20\156\157\167\162a\160\040\141\x6c\x69\x67n\x3d'\x72igh\164' \x77idth\075'\x32\x35\045'\076".$this->x1d($valueW["v\x61\x74"])."\x3c\057\164\144\x3e\015\012\x09    \040\x20\040\040\040\040\x20\040 \x20 \x20   \x20\040  \x20\x20\040\074\057tr>"; } } $vattable .= "\074\057t\x61\142le\x3e";}else{ $vattable = "";}$this->replacements["\x24"."\126\101\124\102\114\117\x43K\044"] = $vattable;$this->replacements["$"."\x54\x4f\x54A\114W\x49T\110VA\x54\044"] = $Products["\x54\x4fT\x41\114"]["T\x4fTA\114\127I\124\x48\126A\124"];$this->replacements["$"."\x53\110\x54\101XAM\x4f\125\116T\x24"] = $Products["\124\x4f\124\x41\114"]["\123\x48\x54A\130A\115O\x55\116T"];$this->replacements["\x24"."SH\124AXT\x4f\x54AL\x24"] = $Products["\124O\x54A\x4c"]["S\x48\124A\130T\117\x54A\x4c"];$this->replacements["\x24"."\124\117\x54A\x4c\104\111\x53\103\117U\116\124\x24"] = $Products["T\x4f\x54\x41\114"]["F\111\116A\114\x44\x49\123\x43\x4f\x55\x4eT"];$this->replacements["\044"."\x54\x4fT\x41L\104ISC\x4f\125\116TPER\103E\x4eT$"] = $Products["T\117TA\x4c"]["F\111\x4e\101\114\x44IS\x43\x4f\125\116\124\120\x45\122CE\x4e\x54"];$this->replacements["\x24"."\x54\117\124ALAFTE\122\104\x49\123\x43O\x55\x4e\124$"] = $Products["T\117\x54\x41\114"]["\x54\x4f\x54A\114AF\x54\x45\x52DI\123\103O\125NT"];$this->x12();$var_array = array();if($x21($this->content,"#\120\x52\x4f\104U\103\124\102\x4cOC\137ST\x41\x52\x54\x23") !== false && $x21($this->content,"#\120\x52\117\x44U\103\124\x42\x4cO\103\x5f\105N\104\x23") !== false){$tableTag = $this->x0c();$breaklines_array = $this->x16();$breaklines = $breaklines_array["\160r\157\x64u\143\x74s"];$show_header = $breaklines_array["s\x68o\x77_h\x65\141\144\x65\x72"];$show_subtotal = $breaklines_array["s\150o\167_\x73\165\x62\x74\x6f\164\x61l"];$breakline_type="";if($x0d($breaklines)>0){if($tableTag!==false) {$breakline_type="\x3c/\x74\x61\142\x6c\x65>".$this->pagebreak.$tableTag["t\x61\147"];if($show_header==1)$breakline_type.=$tableTag["h\145\141\x64\x65\162"];if($show_subtotal==1)$breakline_type=$tableTag["su\142t\157t\141\154"].$breakline_type;}else$breakline_type=$this->pagebreak;}$ExplodedPdf = array();$Exploded = $x0f("\043P\122\117\104\x55\103\124B\x4cO\x43\137S\124\101\x52\124\043",$this->content);$ExplodedPdf[] = $Exploded[0];for($iterator=1;$iterator<$x0d($Exploded);$iterator++){$SubExploded = $x0f("\x23\120\x52OD\x55C\124BLOC\x5f\x45N\104\x23",$Exploded[$iterator]);foreach($SubExploded as $part)$ExplodedPdf[] = $part;$highestpartid = $iterator*2-1;$ProductParts[$highestpartid]=$ExplodedPdf[$highestpartid];$ExplodedPdf[$highestpartid]='';}foreach ($Products["\120"] AS $Product_i => $Product_Details) {foreach($ProductParts as $productpartid=>$productparttext){$breakline="";if($breakline_type!="" && isset($breaklines[$Product_Details["\x53\105\122\126\x49C\105\x53\137\x52EC\x4f\122\104\137\x49\104"]."\x5f".$Product_Details["P\x52\117\x44U\x43\124\123\x45QU\105\x4e\103\105"]]) || isset($breaklines[$Product_Details["\120\x52\x4f\x44\x55\103\x54\123\137\x52\x45\x43OR\104_\111\104"]."\x5f".$Product_Details["\x50\122OD\x55\103\124\123\x45QU\105\116\103\105"]]) ){$breakline=$breakline_type;}$productparttext.=$breakline;foreach ($Product_Details AS $coll => $value) {$productparttext = $x1c("$".$x20($coll)."$",$value,$productparttext);}$ExplodedPdf[$productpartid].=$productparttext;}}$this->content = $x14('',$ExplodedPdf);}}}private function x0e($emodule, $efocus, $is_related = false, $is_inventory = false) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $related_fieldnames = array("\x72\x65\x6c\x61\x74\145d\137\164\x6f","\x72\145\x6c\x61te\x64to","pa\x72e\156\x74_i\x64","\x70a\162\x65\156\x74\151d","\x70r\x6f\144\165\x63\x74\137\x69\x64","\x70\162\x6f\x64uc\x74\x69\144","s\x65\162\x76\x69c\145\x5fid","s\x65\162v\151\x63\x65\x69d","\x76\145\x6edor_\151\144","\160\x72\x6fd\165\x63\x74","ac\x63\157\x75\x6e\164","i\156v\x6f\151c\x65\x69\144","l\151n\153\x74\x6facc\x6f\165ntsc\157n\164ac\164s","\160\162\157\152\145ct\151\144","\x73\x63\137r\x65\x6c\141\164\x65d\137\164o");if($is_inventory)$inventory_content=array();$tabid = getTabid($emodule);if ($is_related)$related = "R\137";else$related = "";$Checkboxes = array();$Picklists = array();$Textareas = array();$Datefields = array();$Multipicklists = array();$sql = "\x53\x45\x4c\x45\x43\124\040\x66\151\x65\154\x64\x6eame\054\x20\165\151t\x79pe\040F\x52\x4fM\040\166t\151g\145\x72\137f\x69\145\154\144\x20W\x48\105R\x45\x20\x74\x61b\151\x64\x20\x3d\040'".$tabid."'";$result = $this->db->query($sql);while($row = $this->db->fetchByAssoc($result)){if ($row["\165\151t\171p\145"] == "\x31\071" || $row["ui\164\171\x70\145"] == "\x32\x30" || $row["\x75\151\x74\x79\x70\x65"] == "\x321" || $row["\165\x69\164\171\160\x65"] == "\0624")$Textareas[] = $row["f\x69e\x6cd\156\141\155\x65"];elseif ($row["u\x69\164\171p\x65"] == "5" || $row["\x75i\164yp\145"] == "\x32\x33" || $row["u\151\x74y\160\x65"] == "7\x30")$Datefields[] = $row["\146\x69el\x64\156\141\x6d\145"];elseif ($row["\165i\164\171\160\145"] == "\x315" || $row["\x66i\145ldn\141\155\145"] == "\163\141\154\165\x74\x61t\x69\x6fn\x74\x79\x70e")$Picklists[] = $row["\x66i\x65\154d\x6eam\x65"];elseif ($row["ui\164\171p\145"] == "\x356")$Checkboxes[] = $row["\x66\151\x65ldnam\x65"];elseif ($row["ui\x74y\160\145"] == "3\x33")$Multipicklists[] = $row["f\151\145\x6c\x64n\x61\x6d\145"];}foreach ($efocus->column_fields as $fieldname => $value){if ($fieldname == "\141\163s\151\x67\x6e\145d_\165s\x65\162\137\x69\144")$value = $this->x18($value);elseif($fieldname == "a\143\x63\157\165\x6e\164_\x69\x64") { $value = getAccountName($value);}elseif($fieldname == "\160\x6f\164\145n\164\x69\x61\154\x5f\151\x64")$value = getPotentialName($value);elseif($fieldname == "\x63\x6f\x6eta\x63\x74\x5fi\x64")$value = getContactName($value);elseif($fieldname == "\x71\165\x6f\164\x65\x5f\x69\x64")$value = getQuoteName($value);elseif($fieldname == "\163\x61\x6c\145so\x72\x64\x65r\x5f\151d")$value = getSoName($value);elseif($fieldname == "\143a\155\x70\x61\151gn\151d")$value = getCampaignName($value);elseif($fieldname == "\164\x65\x72m\163_\x63\157n\x64it\151\x6f\156s")$value = $this->x1f($value);elseif($fieldname == "\143omm\x65n\164\163")$value = $this->x20($efocus);elseif($fieldname == "\x66\157\154d\145rid")$value = $this->x21($value);elseif($x15($fieldname, $related_fieldnames)) {if ($value != "") {$parent_module = getSalesEntityType($value);$displayValueArray = getEntityName($parent_module, $value);if(!empty($displayValueArray)) {foreach($displayValueArray as $key=>$p_value) {$value = $p_value;}}if($fieldname=="\x69\156\166oic\145\151d" && $value=="\x30")$value="";}}if($x15($fieldname, $Datefields))$value = getValidDisplayDate($value);elseif($x15($fieldname, $Picklists)) {if(!$x15($x24($value), $this->ignored_picklist_values))$value = $this->x1a($value,$emodule);else$value = "";}elseif($x15($fieldname, $Checkboxes)) {$pdf_app_strings = return_application_language($this->language);if($value == 1)$value = $pdf_app_strings["y\145\163"];else$value = $pdf_app_strings["\x6e\x6f"];}elseif($x15($fieldname, $Textareas))$value = $x18($value);elseif($x15($fieldname, $Multipicklists)) $value = $x1d(' |##| ',', ',$value); if ($is_inventory)$inventory_content[$x20($emodule."\137".$fieldname)] = $value;else$this->replacements["\044".$related.$x20($emodule."\137".$fieldname)."\x24"]=$value;}if($is_inventory)return $inventory_content;else$this->x12();}private function x0f() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $cur_usr = "\143\165\162r\x65nt\x5f\165\163e\x72";$root_dir = "root_\x64\151\x72\x65c\164o\162y";global $$cur_usr,$$root_dir; $sql = "\x53\x45\114\105\x43T \x2a F\x52\x4f\x4d v\x74\x69ge\162_\157\x72g\141\x6ei\172\x61\164\151\x6f\x6e\144eta\x69\154s";$result = $this->db->query($sql);$Org_Details = $this->db->fetchByAssoc($result, 1);foreach ($Org_Details AS $coll => $value) {if ($coll == "l\x6f\147o")$value = "\x3c\x69mg\040\163\x72c\075\"".$$root_dir."t\145\x73\x74\x2f\154\157g\157\x2f".$Org_Details["\x6c\x6fg\157\156\141me"]."\"\x3e";$this->replacements["\044".$this->org_cols[$coll]."$"] = $value;} $sql = "\123E\x4c\105\x43\x54\040\x74\141\x6edc\040\x46\122O\115\x20\166\164\151\147er\137\x69n\x76\x65\x6e\164\157\x72\171\137\x74a\x6e\144\x63\x20\127HER\x45 t\x79\160e\040= '\x49n\166en\164o\x72\x79'";$tandc = $this->db->getOne($sql,0,"\164a\x6ed\x63");$this->replacements["$"."\124ERM\123_\101ND\137CO\116\104\111T\111\x4f\116\x53$"] = $x18($tandc); $user_sql = "\123E\x4cE\103\x54\x20u\163\x65\162\137\156\141\155e\x2c\146\x69rst_\156\x61\x6de\054\x20l\x61\163t\x5f\156\x61m\145\x2c\x20\x65\155ai\154\x31\054\x20\x70ho\x6e\x65_\167\x6frk\x2c\x74\x69\164\x6c\x65\x2cadd\162e\163\x73_s\x74\x72\x65\145\x74\x2c\x61\x64d\162\x65\x73s_ci\164\x79\x2c\141d\144\x72\145s\163\x5f\163\164\141\164e\054ad\144\162\145\x73s_\160o\163t\x61\154\x63\157d\145\054\x61\144\x64r\x65\x73s\137\143\157\165\156\164\162\x79\015\012\x20\x20 \x20\040 \x20\040\x20\040   \040\x20\x20  \x20\106R\x4f\x4d\x20v\x74i\x67\x65\162_\165\163e\x72\x73\040W\x48\x45\x52E \151\x64\075".$this->focus->column_fields["\x61\163\163\x69\147\156ed_u\163\145r_id"];$user_res = $this->db->query($user_sql);$user_row = $this->db->fetchByAssoc($user_res);$this->replacements["\044"."U\123\x45R\137\125SERN\x41\x4d\105$"] = $user_row["u\x73\145\x72\137\x6e\141m\x65"];$this->replacements["$"."U\x53\x45\122\137\106I\122\x53\124\116\101M\105\x24"] = $user_row["f\x69r\x73\x74_n\x61\x6d\145"];$this->replacements["\x24"."\125SER_\114\101S\x54\x4e\x41M\105$"] = $user_row["l\141\x73\164_\x6e\x61m\x65"];$this->replacements["\044"."US\105R\137\x45MA\x49\x4c\x24"] = $user_row["e\155\141\x69l\x31"];$this->replacements["\044"."US\x45R_PHO\116\105\x24"] = $user_row["p\x68one\x5f\167\x6frk"];$this->replacements["\044"."U\x53E\122\137TI\124\114\x45\044"] = $user_row["titl\x65"];$this->replacements["$"."\125\x53ER\137\x41\104\x44RE\123\x53\044"] = $user_row["\141\x64\x64r\x65\163\163\x5fs\x74r\x65e\164"];$this->replacements["\x24"."\125\x53E\122\137\103\111TY\x24"] = $user_row["\x61\144\x64\162ess_\x63i\164\x79"];$this->replacements["\x24"."U\123\x45\122\x5fS\x54\101\124E$"] = $user_row["\x61\x64d\x72\x65\x73\x73\137\163\x74a\164\x65"];$this->replacements["$"."U\x53\105\x52\137\132\x49P\044"] = $user_row["a\144\x64\162\x65\x73s\137\x70\x6f\x73\164\141\x6c\x63\157\144e"];$this->replacements["$"."\125\x53\x45\122\137\103\117\x55N\x54\x52\x59\x24"] = $user_row["\x61dd\x72es\163\x5fco\x75\156\164\x72\171"]; $this->replacements["\044"."L\137\x55\x53E\x52\x5f\x55S\105\122\x4eA\x4dE\x24"] = $$cur_usr->column_fields["\165\x73\145r\x5f\156ame"];$this->replacements["\x24"."\114\137U\123\105R\137\x46\111\x52\123\x54\x4e\x41M\105\044"] = $$cur_usr->column_fields["fir\x73t_\156\x61\155\x65"];$this->replacements["$"."\x4c\x5fUS\x45\x52_\114\101\123TN\101\115\x45\044"] = $$cur_usr->column_fields["la\163\x74_\x6e\141m\145"];$this->replacements["\x24"."\x4c\x5f\125\x53\105R_\105\x4d\101\x49\114\044"] = $$cur_usr->column_fields["e\155\141\x69\1541"];$this->replacements["$"."\x4c_\125\x53\x45R\x5fP\110O\x4e\105\x24"] = $$cur_usr->column_fields["ph\x6f\x6ee\137work"];$this->replacements["\044"."L\137U\123ER_T\x49\x54L\x45\044"] = $$cur_usr->column_fields["\x74it\x6c\145"];$this->replacements["$"."L_\125\x53\x45\x52_\101D\104\x52E\123S\x24"] = $$cur_usr->column_fields["\141\144dr\x65s\x73_\163\x74re\x65\x74"];$this->replacements["\044"."L\137U\123\105\x52\x5f\103\x49T\x59\x24"] = $$cur_usr->column_fields["\141\144d\162\x65\163\163\137\x63\151t\171"];$this->replacements["\044"."L\x5fU\x53\105\122\x5f\123\124\x41T\105\x24"] = $$cur_usr->column_fields["a\x64d\162\145\x73s_\x73ta\164\x65"];$this->replacements["$"."\114\x5f\x55\x53\x45\122_\132\111\x50\044"] = $$cur_usr->column_fields["\x61\144d\x72e\163\163\x5f\x70\157s\164alco\x64\x65"];$this->replacements["\x24"."\114\x5f\125SER_C\x4f\x55N\124RY\x24"] = $$cur_usr->column_fields["a\x64dr\x65\163\163_\x63o\165\156\164\162\x79"];$this->x12();}private function x10(){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24;  $app_lang = return_application_language($this->language); $mod_lang = return_specified_module_language($this->language,$this->module); if($x21($this->content, "\045G\137")!==false){ foreach($app_lang as $key=>$value){ $this->replacements["\x25\x47\x5f".$key."\045"] = $value; } } if($x21($this->content, "\045\115\137")!==false){ foreach($mod_lang as $key=>$value){ $this->replacements["\x25\x4d\x5f".$key."\x25"] = $value; } } $this->x12();}private function x11(){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; require_once("c\x6ca\x73\x73e\x73\057\x73\151m\x70le\137h\164ml\x5fd\157\155\056\x70\x68p");$this->replacements["[\x42ARC\117DE|"]="\074bar\x63\x6f\144\145>";$this->replacements["|\102\x41\x52\x43\x4f\x44E\135"]="\074/ba\x72\x63\157\144\145\076";$this->x12();$html = str_get_html($this->content);foreach($html->find("b\x61\x72code") as $barcode) {list($type,$code) = $x0f("\x3d",$barcode->plaintext,2);$barcode->outertext = '<barcode code="'.$code.'" type="'.$type.'" />';}$this->content = $html->save();}private function x12() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; if(!empty($this->replacements)){$this->content = $x1c($x0b($this->replacements), $this->replacements, $this->content);$this->replacements = array();}} private function x13() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $sql = "\123E\x4c\x45\103T\x20\x76\164\151g\145r_\x70d\146m\x61k\145r\x2e\x2a\054\x20\166\x74\x69g\x65\162\137\x70d\x66ma\153\x65r\137\x73\x65\164t\151\156\147s.\x2a\015
\x20\040\x20\x20 \040 \040\x20  \x20 \040F\x52\117\115\040\x76ti\x67\x65r\137\x70\144f\155\141\x6ber
\012\x20\x20 \x20   \x20\x20\040\040\040\x20 \x4c\105\x46T\040J\x4f\111\116\x20\x76\164i\x67\x65r\x5fp\144f\155\x61k\145\162_s\145\x74\x74i\x6eg\163
\x20 \x20\x20\040 \x20 \x20\x20 \x20 \x20\x20\040\x4f\116 vt\x69\147\x65\162_\x70d\146\155\x61\153\x65\162\137\x73e\164\164\x69ng\x73\056\x74\x65\x6dp\154\x61\164\x65i\x64 \x3d\x20\x76\x74\x69\147\x65\x72\137p\x64\x66\155\x61k\145r\x2et\145\x6d\x70\154\141\x74\x65\151\x64\x0d\012\x20 \040\x20\040\x20\x20 \x20   \040\x20\x57H\105R\105\040\166\164\x69g\145\162\x5f\160\x64\x66\155a\153e\162\x2e\x74\145\155\x70\x6cat\x65i\144\075?";$result = $this->db->pquery($sql, array($this->templateid));$data = $this->db->fetch_array($result);$this->decimal_point = $x13($data["\x64ec\151\x6d\141\154\x5f\160\157\x69n\x74"], ENT_QUOTES);$this->thousands_separator = $x13(($data["thous\141\x6ed\x73\137\x73\x65\160ar\141\164\157\x72"]!="s\160" ? $data["\164\150o\165s\x61\x6e\x64\163\137se\160\x61r\141\164o\x72"] : " "), ENT_QUOTES);$this->decimals = $data["de\143i\x6da\x6c\163"];$this->header = $data["\150\145\141d\145\162"];$this->footer = $data["\146\157\157t\x65\162"];$this->body = $data["\x62\x6f\144\x79"];$this->filename = $data["\x66\151\x6c\x65\x5f\x6eam\x65"];$this->templatename = $data["fil\145\156a\155\145"]; $this->pagebreak = '<pagebreak orientation="'.$data["\x6f\162i\x65\156\164\141\x74\151\x6f\156"].'" margin-left="'.($data["\155\x61\x72\x67i\x6e\137l\x65ft"] * 10).'mm" margin-right="'.($data["ma\162\x67i\156_\162i\x67\x68\164"] * 10).'mm" margin-top="0mm" margin-bottom="0mm" margin-header="'.($data["m\x61rg\x69n_t\x6fp"] * 10).'mm" margin-footer="'.($data["ma\162\147in\x5fbo\164t\x6fm"] * 10).'mm" />';}private function x14() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $sql = "\x53\105\114E\x43\x54 \x76\141\154ue \x46R\117\x4d\040v\x74\151\x67\x65r\137\160\144\x66make\162_ign\157\162e\x70ic\x6b\x6ci\163\x74\x76\x61\154\165\x65s";$result = $this->db->query($sql);while($row = $this->db->fetchByAssoc($result)) {$this->ignored_picklist_values[] = $row["v\141\x6c\x75\145"];}}private function x15() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $taxtype = $this->x1c();$currencytype = $this->x1b();$query="sel\145c\x74\x20c\141se w\x68\x65\x6e \166\x74ige\x72_p\162o\144\x75c\164\x73\056\160\162o\x64\x75\143ti\x64 \x21\075\x20''\x20\164\150\x65\156\x20\166t\x69g\145\162\137\x70r\x6f\144u\143\164s\056\160\162o\144u\x63\164\x6e\x61\155\145 e\154\x73\145\040vt\151\147\145r\137se\162\x76i\143\145.\163\145\162\x76\151ce\156\141\155\x65 \145\x6ed\x20\x61\163\040p\x72\x6f\144\165c\x74\x6ea\155\x65\054" ." c\141\163e\040\167\150\x65\156\040vt\151\x67\x65\x72_pro\x64\x75\x63\x74s\x2e\x70r\x6f\x64u\143\x74\151d\040\041\075 '' \164h\145\x6e\x20\166t\151\147e\162\x5fprod\165c\x74s\056\x70r\x6f\x64\165\x63\x74\151\x64\040\145\x6cs\145\040\x76\164ig\x65r_se\162\166i\143\x65\x2es\x65r\166\x69\143\x65id e\x6ed\040a\x73\x20\160\163\x69\x64," ."\x20\143\x61\x73\x65\040\x77\150\x65\156\x20\x76\x74\151\147\145\162\x5f\x70ro\144\x75\x63t\x73.pro\144\x75\x63ti\144\x20\x21\x3d\040''\040\164h\x65\156\x20\x76t\x69\147e\162_\160\162odu\x63\164\x73\x2ep\x72o\x64\165\x63\164\137\156o \x65l\x73\x65\x20\x76\164\x69\x67\145\x72\x5fs\145\162\x76\151c\145.\163e\x72\166ic\145_n\157\040\145\156\x64\x20\141\163 \160\x73\156\x6f\054" ."\x20\x63\x61\x73\x65\040\x77\150\x65\x6e\x20v\x74\x69\x67er_\x70\162oduc\x74s\056\x70\x72o\144u\x63\x74\x69\x64\x20\041\x3d\040''\040\x74h\x65n\040'P\x72\157\x64u\143\x74\163' \145\154\x73e\x20'\x53\x65\x72vi\143e\x73'\040e\156\144\040a\163\040\145n\x74\151t\171\164\171p\145\x2c" ."\040c\141\x73\x65\040w\150\x65n\x20\166\x74i\x67\145\x72\x5f\160r\157d\x75\143ts\056p\162o\x64\165ctid !\075\040'' \x74h\145\x6e\x20vt\151g\145\162\x5fp\x72\157\x64u\x63ts\056\165n\151t\137p\x72i\x63\145 \x65l\163\145\x20\166t\151\147er_\163\145r\x76i\143\x65\056\165\156\151t_p\162\x69c\x65 \x65\156d\040\x61\x73 \x75\x6e\151t\x5f\x70\162\151\x63\x65\054" ." ca\x73e\x20w\150\145n \x76ti\x67e\x72\x5f\160\162\x6fd\165c\164s.\x70\x72\157\144u\143\x74\151\144\x20!= ''\040\164\150\x65\156\x20v\164\x69\x67\145\x72\x5fpr\x6fdu\143\x74\x73\056\x75\x73a\147e\x75\x6ei\164 \x65l\x73\145 v\164\x69\x67e\162_\x73\x65\162\x76i\143\145.s\x65r\x76\151ce_\165\x73\141g\x65\x75\x6e\151\x74\x20\x65\x6e\x64 a\x73\040\x75s\x61\x67\x65\165\x6e\151t\054" ." \143as\145 \167\150e\156\x20\166\164ig\145r\137\x70\162od\x75\143\x74\x73.p\x72\x6f\x64\165\x63\164\x69d\040\x21\075\040''\040\x74\x68\145\x6e\x20\x76\164\x69\147\145r\x5f\160r\157\x64\165c\x74s\056q\164\x79_\160e\x72\x5fu\156\x69t \x65l\x73\145 \x76t\151\147\x65\162\137\x73e\162\x76\x69c\145\056\161\164\x79\x5f\160\145\x72\x5f\x75\x6e\x69\164\x20e\x6e\144\x20\141\x73 \161\x74y_\x70er_\x75\x6e\151\164\x2c" ."\040ca\x73e whe\x6e \x76\164iger\x5f\160ro\x64\165\x63\164s\x2e\160\x72o\144\x75c\164\x69d\x20\x21=\040'' \x74\x68\x65\156\x20\x76\164\151\147e\162\137\x70r\x6f\x64\x75\x63t\163\056\x71\x74\x79in\163t\x6fc\153\x20\x65lse\040'\x4e\x41'\x20\x65\x6e\x64\x20\141s q\164y\x69\156\x73t\157ck," ."\x20\143\141\x73\x65\040\x77h\x65\156\040\166\x74\x69\x67\145\162\x5fp\162\157d\165c\164s.\160\x72o\x64\165\143tid \041=\x20''\040\164\150\x65\156 \143\061.\144e\163\143\162\151p\164i\157n el\163\x65\x20c\062\x2ed\145\163\x63ri\x70\x74\151\157\156 e\x6e\x64\x20a\x73\x20\160\x73de\x73c\x72\151\x70\x74\151\x6f\156\x2c\x20\166\x74i\x67er\137in\x76en\x74\x6f\162y\160\x72o\x64\165\143t\x72\x65l\056\052\x20" ."\040f\162\157\x6d\x20\x76\x74\151\147\x65\162\137\x69\156\166\145n\x74\157\x72y\160r\157\144\165ct\162\145l" ." l\145\146\164\040\152\x6f\151n\x20\x76ti\147er_\160rod\165\x63\x74\163 \157\x6e\x20\166\164\151g\x65\x72_p\x72o\144uc\164\163\x2e\160r\x6fd\165\143\164\x69\144=v\164ig\x65\x72\x5f\151\156v\145nto\x72\171p\162\x6f\x64\165\143trel\x2ep\162\x6f\144\165\143\164\151d\x20" ."\x20\x6ceft\040\152\157\x69\156\040\x76\164\151g\x65\x72_c\x72\155\145n\164\x69t\x79\040a\x73\x20c\061\040o\x6e c\061.\143r\155i\x64\x20=\x20vt\x69\x67\145\x72\137\x70\162\157\x64\x75\143\164s.\160roduc\x74\x69\x64 " ."\040l\145ft\x20\152o\x69n\x20\166\x74\x69\x67er\x5f\163\x65\162v\151c\x65\x20\x6f\x6e \x76\x74i\147\x65\162\x5f\x73\145\x72\x76i\143\x65\x2e\x73\145\162\x76\151\x63\145id=\x76t\x69ge\x72\137\x69\156\166\145\156to\162\x79\x70\162od\165\143tre\x6c.pr\157\x64\x75\143\164\x69d\040" ."\040\x6cef\x74\040j\157i\x6e\x20v\x74i\147\x65\x72\x5f\x63rm\x65\x6et\151\x74y a\x73 \143\062\040\x6f\x6e\040\143\062\056\143\162m\151d\040\075\x20v\x74ig\145\162_\163\145\x72\x76\x69c\x65\x2e\x73\x65\162\x76\151\143eid " ."\040w\x68\145\x72\x65\040\151\144=?\040\x4f\122\104E\x52\040BY\040\163e\161\x75\x65\156\143e\x5f\x6e\x6f";$result = $this->db->pquery($query, array($this->focus->id));$num_rows=$this->db->num_rows($result);$netTotal = "0.\x300"; $totalAfterDiscount_subtotal=0;$total_subtotal=0;$totalsum_subtotal=0; $images = $this->x17(); for($i=1;$i<=$num_rows;$i++){$sub_prod_query = $this->db->pquery("SE\114E\x43\x54 \160rod\165\x63t\x69\144 fr\x6fm \166\x74\x69g\145\162_\151n\166e\156\x74\157\x72\171\163u\142\160ro\144\x75\x63\164\x72\145\154\x20W\x48E\x52\x45\040\x69d=?\040\101\x4eD\x20se\x71\x75\x65\156\x63e\137\156\157=?",array($this->focus->id,$i));$subprodname_str='';if($this->db->num_rows($sub_prod_query)>0){for($j=0;$j<$this->db->num_rows($sub_prod_query);$j++){$sprod_id = $this->db->query_result($sub_prod_query,$j,"pr\157\x64\165\x63t\151\x64");$sprod_name = getProductName($sprod_id);$str_sep = "";if($j>0) $str_sep = "\x3a";$subprodname_str .= $str_sep."\x20\x2d\040".$sprod_name;}}$subprodname_str = $x1c("\x3a","\074\142\162\076",$subprodname_str);$psid = $this->db->query_result($result,$i-1,"\160s\x69d");$psno = $this->db->query_result($result,$i-1,"\160sno");$productid=$this->db->query_result($result,$i-1,"\160\162o\x64\165ct\151\x64");$entitytype=$this->db->query_result($result,$i-1,"\145n\164\x69\x74\x79t\171\x70\145");$producttitle = $productname= $this->db->query_result($result,$i-1,"pr\157\144\165\x63t\156am\x65");if($subprodname_str!="") $productname .= "\074\142\x72\057>\x3c\x73\x70\141n s\164y\154\145\075'colo\162:\043C0C\060\x43\x30\073\x66o\156\x74\055\163ty\154\x65\x3a\151\164a\154\151\x63;'\076".$subprodname_str."\074/s\160\x61\156>";$comment=$this->db->query_result($result,$i-1,"\143\x6fmm\x65n\x74");$psdescription =$this->db->query_result($result,$i-1,"\x70\x73\x64\145\163c\x72i\160\164\x69\x6f\156");$qtyinstock=$this->db->query_result($result,$i-1,"\x71\x74y\x69n\163t\157\143\x6b");$qty=$this->db->query_result($result,$i-1,"q\165an\x74it\171");$qty_per_unit=$this->db->query_result($result,$i-1,"\161\x74\x79_\160\x65\x72_\165\156\x69\x74");$usageunit=$this->db->query_result($result,$i-1,"\165sag\145\x75n\151\x74");$unitprice=$this->db->query_result($result,$i-1,"\165\156i\x74\x5f\160\x72\151c\x65");$listprice=$this->db->query_result($result,$i-1,"\154ist\160r\151\143e");$total = $qty*$listprice; $discount_percent=$this->db->query_result($result,$i-1,"\144i\163\143\x6f\165\156\x74_\160er\x63\145\156\x74");$discount_amount=$this->db->query_result($result,$i-1,"\x64\151sco\x75n\164\x5f\141\155\x6f\165n\x74");$totalAfterDiscount = $total;$productDiscount = "\060\0560\060";$productDiscountPercent = "";if($discount_percent != "\116\x55L\114" && $discount_percent != "") {$productDiscount = $total*$discount_percent/100;$totalAfterDiscount = $total-$productDiscount; $productDiscountPercent=$discount_percent;}elseif($discount_amount != "N\x55L\114" && $discount_amount != "") {$productDiscount = $discount_amount;$totalAfterDiscount = $total-$productDiscount;} $netprice = $totalAfterDiscount; if($taxtype == "\x69n\144ivid\165a\x6c") {$taxtotal = "\060\056\060\x30";$tax_info_message = $mod_strings["\114\x42\114\x5f\x54\117\124\101L_\x41\106T\105R_D\111\123CO\125\116\124"]."\040\x3d\x20$totalAfterDiscount\040\\\x6e";$tax_details = getTaxDetailsForProduct($productid,"\x61\154\154");for($tax_count=0;$tax_count<$x0d($tax_details);$tax_count++) {$tax_name = $tax_details[$tax_count]["\164\x61\170name"];$tax_label = $tax_details[$tax_count]["t\141x\x6c\141b\145\x6c"];$tax_value = getInventoryProductTaxValue($this->focus->id, $productid, $tax_name);$individual_taxamount = $totalAfterDiscount*$tax_value/100;$taxtotal = $taxtotal + $individual_taxamount; } $netprice = $netprice + $taxtotal;if($tax_value == "" || $tax_value == "NUL\x4c")$tax_value = "\x30.00";$Details["\x50"][$i]["PR\117DUC\x54\126\x41\x54P\x45\x52C\105\x4eT"] = $this->x1d($tax_value);$Details["P"][$i]["\x50\x52\x4f\104\125\103\124\x56A\x54\x53\125\115"] = $this->x1d($taxtotal);if ($tax_name != "" OR $tax_value > 0){ $vatblock[$tax_name]["\156\145\164t\x6f"] += $totalAfterDiscount; $vatblock[$tax_name]["\166\x61\x74"] += $x1a($taxtotal,$this->decimals);$vatblock[$tax_name]["\166\141\154\x75\x65"] = $tax_value;}}if ($entitytype == "Pr\157\144\x75c\x74\163"){ $Details["P"][$i]["\x50R\x4f\104\x55\x43TS\137\x43R\115\111D"] = $psid; $Details["\120"][$i]["\x53\x45\x52V\111CE\x53\137C\122\115ID"] = "";}else{ $Details["P"][$i]["\x50\x52\117\104UCTS\x5f\103R\x4d\x49D"] = ""; $Details["P"][$i]["\x53\x45R\x56\x49C\x45\123\137\x43\x52\x4d\111\104"] = $psid;}$Details["\x50"][$i]["\120S_\x43\x52M\111D"] = $psid;$Details["\x50"][$i]["P\x53\x5fN\x4f"] = $psno;if($comment!="")$productname .= "\x3cb\162\x20\x2f\076\x3cs\x6d\x61\154l\x3e".$x1c("\\\156", "\x3c\x62r\x3e", $x18($comment))."\x3c\057\163\x6d\141\154\x6c>";$Details["P"][$i]["\x50\x52O\104U\103\x54\116\x41\x4d\105"] = $productname;$Details["P"][$i]["\x50R\117\x44\125C\124\x54I\124\114\105"] = $producttitle;$Details["P"][$i]["P\x52\x4f\x44U\x43T\x44\x45\123\103\122\111\120\x54\111ON"] = $psdescription;$Details["\x50"][$i]["\x50\122\x4fD\x55\x43\x54E\x44\111\124\x44E\x53C\122\111P\x54\x49\117\116"] = $x1c("\\\156", "\074\x62r\x3e", $x18($comment));$Details["P"][$i]["P\122OD\125\103\124\114IS\124P\x52\x49CE"] = $this->x1d($listprice);$Details["\120"][$i]["\120\x52O\x44U\x43TTO\124A\114"] = $this->x1d($total);$Details["P"][$i]["\x50\x52\117\104U\x43\x54\121U\x41\116\x54\111TY"] = $this->x1d($qty);$Details["P"][$i]["PR\x4fDUC\x54\121I\x4eST\x4fCK"] = $this->x1d($qtyinstock); $Details["\x50"][$i]["\120\x52O\104\125\103TP\x52IC\x45"] = $this->x1d($unitprice); $Details["\x50"][$i]["P\122\x4f\104\125\x43T\120\117\123\x49\124\111\x4f\116"] = $i;$Details["\x50"][$i]["\120\x52\x4f\x44\x55C\x54Q\124\x59\x50E\122\125\116\111T"] = $this->x1d($qty_per_unit); $Details["P"][$i]["\x50\x52\117D\x55\103\x54U\x53\101GE\x55\116\x49\x54"] = $this->x1a($usageunit,"\120\x72\x6fd\165\143ts/\x53\x65\162\166ice\x73");$Details["\x50"][$i]["PR\x4f\x44U\103\x54DI\x53\x43O\125\116\124"] = $this->x1d($productDiscount);$Details["P"][$i]["P\122\x4f\x44\125\103T\104\111\x53\x43\x4f\x55\x4e\x54P\105\122C\x45\116T"] = $this->x1d($productDiscountPercent);$Details["P"][$i]["PR\x4f\x44U\x43\x54\x53T\117\124\x41L\x41\x46\124E\x52\x44\x49S\x43\117U\116TSU\x4d"] = $totalAfterDiscount; $Details["\x50"][$i]["\x50\122\117DU\103\x54S\124\117\x54\x41\114A\106\124ERDIS\x43O\x55\116\124"] = $this->x1d($totalAfterDiscount);$Details["P"][$i]["\120\x52\x4f\x44\x55CT\124\x4fT\101\x4cS\x55\115"] = $this->x1d($totalAfterDiscount+$taxtotal); $totalAfterDiscount_subtotal += $totalAfterDiscount;$total_subtotal += $total;$totalsum_subtotal+= $totalAfterDiscount+$taxtotal;$Details["P"][$i]["\x50R\x4f\x44UC\124\123T\117\x54\x41\x4cA\106\x54\105\122\104I\x53\x43\x4fU\116T\x5fSU\x42T\117\x54AL"] = $this->x1d($totalAfterDiscount_subtotal);$Details["\120"][$i]["PRODU\x43\x54\124\x4f\124A\x4c_\x53U\x42\x54\x4f\x54\x41\x4c"] = $this->x1d($total_subtotal);$Details["P"][$i]["\120R\117\x44\x55C\124\x54\x4fTA\x4c\x53U\x4d\x5f\x53\125BT\x4f\x54\x41\114"] = $this->x1d($totalsum_subtotal); $sequence = $this->db->query_result($result,$i-1,"s\x65\161\165\x65\x6e\x63\x65\x5f\x6eo");$Details["P"][$i]["\120\122\x4fD\125\103\124S\x45Q\125\105\116CE"] = $sequence;if(isset($images[$productid."_".$sequence])){$width="";$height="";if($images[$productid."\x5f".$sequence]["\167\x69\144\164h"]>0)$width="\040\167i\x64\x74h\075'".$images[$productid."_".$sequence]["wi\x64\x74\x68"]."'\040";if($images[$productid."\x5f".$sequence]["\150\x65\151\147\x68\x74"]>0)$height="\040heig\x68\x74\075'".$images[$productid."_".$sequence]["\150\145\x69\147ht"]."'\x20";$Details["P"][$i]["PR\x4fD\125\103\x54S_\x49\115\101GE\116\101\x4d\105"] = "<im\147\040\x73\162\x63\x3d'".$images[$productid."\137".$sequence]["\x73\x72c"]."' ".$width.$height."/>";} $focus_p = CRMEntity::getInstance("\x50\x72o\x64\165\x63\164\x73");if ($entitytype == "P\162\157d\x75c\x74s" && $psid != "") {$focus_p->id = $psid;$this->x1e($focus_p,$psid,"\120roduc\x74\x73"); }$Array_P = $this->x0e("\120\x72\x6f\144\165\x63\x74\163", $focus_p, false, true);$Details["\x50"][$i] = $x0c($Array_P,$Details["\x50"][$i]);unset($focus_p);$focus_s = CRMEntity::getInstance("Ser\166\x69ces");if ($entitytype == "S\145\162v\x69c\145\x73" && $psid != "") {$focus_s->id = $psid;$this->x1e($focus_s,$psid,"\x53\x65\x72v\x69\143\x65\163"); }$Array_S = $this->x0e("Se\162\166\x69ce\x73", $focus_s, false, true);$Details["P"][$i] = $x0c($Array_S,$Details["\120"][$i]);unset($focus_s); $sumwithoutvat += $totalAfterDiscount;$netTotal = $netTotal + $netprice;} $finalDiscount = "\060.\x30\060";$final_discount_info = "\x30";$finalDiscountPercent=""; if($this->focus->column_fields["\150dnD\151s\x63o\165ntP\145\x72\x63e\156\x74"] != "\060") {$finalDiscount = ($netTotal*$this->focus->column_fields["hd\x6e\104i\163c\x6fu\x6et\120e\162\x63\x65n\164"]/100);$finalDiscountPercent = $this->focus->column_fields["\150\144\156Dis\x63\x6fun\x74\120\145\x72\x63ent"];}elseif($this->focus->column_fields["\150\144\x6e\x44\151sc\157u\156t\101\x6d\x6f\x75\156\x74"] != "\060") {$finalDiscount = $this->focus->column_fields["h\144\156Di\x73c\157\165\x6etA\x6d\157\x75\x6e\164"];} $taxtotal = "\x30\x2e\060\060";if($taxtype == "\x67r\x6fu\160") {$final_totalAfterDiscount = $netTotal - $finalDiscount;$tax_details = getAllTaxes("\x61v\x61\151\x6c\141b\154e","","e\144\151\164",$this->focus->id);for($tax_count=0;$tax_count<$x0d($tax_details);$tax_count++) {$tax_name = $tax_details[$tax_count]["\164\141\170\x6e\141m\x65"];$tax_label = $tax_details[$tax_count]["t\141\170la\142\x65\154"];$tax_value = $this->db->query_result($result,0,$tax_name);if($tax_value == "" || $tax_value == "\116\125\114\x4c")$tax_value = "0.00";$taxamount = ($netTotal-$finalDiscount)*$tax_value/100;$taxtotal = $taxtotal + $taxamount;if ($tax_name != "" OR $tax_value > 0){$vatblock[$tax_name]["ne\164\x74\157"] = $final_totalAfterDiscount; $vatblock[$tax_name]["\166\x61t"] += $taxamount; $vatblock[$tax_name]["\x76\x61\154u\145"] = $tax_value; }$total_vat_percent += $tax_value;}$vat_value = $taxtotal; foreach ($Details["\120"] as $keyP=>$valueP) {$productvatsum = ($Details["P"][$keyP]["\120RO\x44\125\103\x54\123T\x4fTA\x4c\101\106TE\x52\x44\x49\x53\103\117U\116\x54S\125\x4d"]*$total_vat_percent)/100;$producttotalsum = $Details["\120"][$keyP]["PR\117\x44\x55\103\124\x53TO\124AL\101\x46TE\x52\104I\123\103\x4f\125\116T\x53\x55\115"] + $productvatsum;$Details["P"][$keyP]["\120RODUC\124\126\x41TP\105\x52C\x45\x4eT"] = $this->x1d($total_vat_percent);$Details["\120"][$keyP]["\x50\122O\x44UC\124V\101TS\x55M"] = $this->x1d($productvatsum);$Details["\x50"][$keyP]["P\122O\x44\125\x43\x54\x54\x4f\x54\101\x4cSUM"] = $this->x1d($producttotalsum);} }else{if ($x0d($vatblock) > 0){ foreach ($vatblock as $keyM => $valueM) $vat_value += $valueM["v\x61t"];}else{ $vat_value = "\060.00"; }} $shAmount = ($this->focus->column_fields["\150\144nS_\x48_\x41m\x6f\165n\164"] != "")?$this->focus->column_fields["\x68\x64\156\x53_\x48\137A\x6d\x6f\x75\156\x74"]:"0\x2e\060\x30";$shtaxtotal = "0.\x30\x30";$shtax_details = getAllTaxes("a\166\141\151la\142le","\x73h","edit",$this->focus->id);for($shtax_count=0;$shtax_count<$x0d($shtax_details);$shtax_count++) {$shtax_name = $shtax_details[$shtax_count]["ta\x78\x6e\x61\155e"];$shtax_label = $shtax_details[$shtax_count]["\x74\141\x78lab\145\x6c"];$shtax_percent = getInventorySHTaxPercent($this->focus->id,$shtax_name);$shtaxamount = $shAmount*$shtax_percent/100;$shtaxtotal = $shtaxtotal + $shtaxamount;}$totalafterdiscount = $sumwithoutvat-$finalDiscount;$totalwithvat = ($sumwithoutvat-$finalDiscount)+$vat_value;$Details["T\x4fT\101L"]["\x4eE\x54\124OT\x41\114"] = $this->x1d($netTotal);$Details["\x54\117T\x41\x4c"]["\124\117\x54\101L\x57\111\x54H\x4f\125T\x56\x41\124"] = $this->x1d($sumwithoutvat);$Details["T\x4f\124A\114"]["\106\111\x4e\101LD\x49\123C\117\x55NT"] = $this->x1d($finalDiscount);$Details["\x54\x4fT\101\114"]["\x46\111\116\101LDISC\x4fUN\x54P\105\x52\103\x45N\x54"] = $this->x1d($finalDiscountPercent);$Details["\124\117T\101\114"]["T\117\124ALA\x46T\105RD\111\123\x43\x4fUN\x54"] = $this->x1d($totalafterdiscount);$Details["\x54\117\x54\x41L"]["\x54\x41\130\124O\x54\x41\114"] = $this->x1d($vat_value);$Details["\x54\x4fT\x41\x4c"]["\x54AX\x54OTAL\x50\105R\x43\x45\x4e\x54"] = $this->x1d($total_vat_percent); $Details["\x54\117\124AL"]["\124\x4f\x54\101L\x57\x49\124\110\126\101T"] = $this->x1d($totalwithvat);$Details["\124OTAL"]["\x53\110\124A\130\x41\x4d\x4f\x55N\124"] = $this->x1d($shAmount);$Details["\124\117TA\114"]["\x53H\x54A\x58\x54\117T\101L"] = $this->x1d($shtaxtotal);$Details["\x54\117T\x41L"]["VAT\x42\x4c\117\x43\113"] = $vatblock;return $Details;}private function x16(){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $sql="\123EL\105\103T\x20\x70\162o\x64u\143t\151\x64, \x73\x65q\x75\145n\x63e\x2c\x20\163ho\167_h\x65a\144\145\162,\x20s\150\157w\x5f\x73\x75\x62\164\157tal \106RO\115\040\x76\164\151\x67\x65\x72\x5fp\x64f\x6da\x6b\x65\162_b\162\145\x61\x6bl\x69\156\145\040W\110\x45RE \143r\155id=\077";$res = $this->db->pquery($sql,array($this->focus->id));$products=array();$show_header=0;$show_subtotal=0;while($row=$this->db->fetchByAssoc($res)){$products[$row["\x70r\x6fd\165\x63\x74i\x64"]."\x5f".$row["s\145\x71u\x65\x6ece"]] = $row["s\145\x71\165\x65\156\143e"];$show_header=$row["sho\x77_he\x61der"];$show_subtotal=$row["\163h\157\x77_s\x75btot\x61\x6c"];}$output["p\x72o\144u\143\164\163"] = $products;$output["\163\x68\157\x77\x5f\x68e\141\144\x65\162"] = $show_header;$output["\163\x68o\x77\137\x73ubto\164\x61l"] = $show_subtotal;return $output;}private function x17(){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $sql="\123\105LE\103T\040\x76tig\145r\137at\x74a\x63\150\155\145\156ts\x2e\x70\x61th\x2c\x20\x76\164\151\x67\145\x72\137\x61t\x74ach\155e\x6e\x74\x73\056na\x6de, \x76\164\151\x67\145\x72\137a\164ta\143\150\x6d\145n\164s\x2e\x61\x74\x74\x61\143hm\145n\x74\x73\x69d\054 \160\162o\144uc\x74\151d,\x20s\x65qu\x65n\143\x65,\040wi\x64th\x2c\x20h\x65ig\x68\164\x0d\012\040 \x20\040 \x20\x20\x20 \040 \x20\x46\122O\115\x20\166t\x69ge\162\x5f\160\x64\x66\155ak\x65r\x5fim\x61g\145\163\015\012 \040\040 \040\040\040\x20\040 \040 I\x4e\116E\x52\040\x4aO\x49\x4e \x76t\x69\x67\145r\137a\164\164ac\x68\x6d\145\x6ets\015\012 \040\x20\x20 \x20\040 \040\040\040\x20\x20\x20\117N\x20\166\x74i\x67er\x5f\141t\x74\x61c\150\155\x65n\x74s\056\141\x74\164\141\143hme\156\x74\163i\144\x3dvt\151\147\x65\162\x5fpd\146\x6d\x61\x6b\x65\x72\137\151\x6da\147\145s\056\x61\x74ta\x63h\155\145n\x74\x69\144
\040  \040\040 \x20 \040\x20\x20 \111\116\116\105\122\x20J\117\x49N \166\x74i\x67\145\162\137\x63\x72\155\x65\156t\x69\164\x79\015
\x20  \x20\040  \040 \040\040\x20\040\x20O\116\040\166\x74\151\147\x65r\137a\164\x74\141\x63\x68\155\145n\x74\163\x2e\141t\164\x61\x63h\155\145\x6e\164\x73\x69\144\075\x76t\151ge\162_\x63rme\156\x74i\x74\x79.\143\x72\155\x69\x64\x0d
\040 \x20\040\x20  \x20 \040\040\040\127H\105\122\x45\x20de\154et\x65d\x3d0\x20\101\116D\x20\x76ti\x67e\162\137pdfm\x61\x6b\145r_i\x6d\x61\147e\x73.\x63\162m\151\x64=\077";$res = $this->db->pquery($sql,array($this->focus->id));$products=array();while($row=$this->db->fetchByAssoc($res)){$products[$row["\x70\162od\x75\x63\x74\151\x64"]."\137".$row["s\x65\161\165\x65\x6ec\145"]]["s\x72c"] = $row["p\141t\x68"].$row["\141\x74ta\143\x68\155e\x6e\x74\163id"]."\137".$row["\x6ea\155\145"];$products[$row["\x70\162\x6f\x64uc\164\151d"]."\137".$row["s\145\161u\145\x6e\143\145"]]["\167\x69dth"] = $row["\x77\151\x64th"];$products[$row["\160\x72od\165ct\x69\x64"]."\137".$row["se\161\165\145n\x63\x65"]]["\x68\145\151\147\150\164"] = $row["height"];}return $products;} private function x18($id) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; if($id != "") {$sql = "SE\x4cEC\x54\040\x75ser_n\x61m\145\x20\x46\122\x4f\115 v\x74\x69\x67er\x5f\165\x73\145\162s\x20\127HE\122E\040id\x3d?";$result = $this->db->pquery($sql, array($id));$ownername = $this->db->query_result($result,0,"\x75s\145r\x5fna\x6de");}if($ownername == "") {$sql = "S\105\x4cE\103\x54\040\x67\162\x6fu\160n\x61\x6d\145\040FRO\x4d\040\166\164ig\x65\x72_\x67\x72\x6f\x75\x70s\x20W\110\x45RE\x20g\162\157\165pi\x64=?";$result = $this->db->pquery($sql, array($id));$ownername = $this->db->query_result($result,0,"g\x72ou\160n\141m\145");}else {$ownername = getUserFullName($id);}return $ownername;}private function x19($account_id) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $accountno = "";if($account_id != '') {$sql = "\x53E\x4c\105\x43T\040\x61\143\x63\x6fu\156\164\x5f\156\x6f\x20FR\x4f\115\040\x76\x74i\x67e\x72_\141\143\143\x6f\x75\x6et\x20\127\x48E\x52E\040a\x63\x63o\165n\x74i\x64=\x3f";$result = $this->db->pquery($sql, array($account_id));$accountno = $this->db->query_result($result,0,"\141\x63c\157\165\156t_\156o");}return $accountno;}private function x1a($str,$emodule) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; if($emodule!="\x50r\x6f\x64ucts\x2f\123e\x72v\151\x63\x65\163") {$app_lang = return_application_language($this->language);$mod_lang = return_specified_module_language($this->language,$emodule);}else {$app_lang = return_specified_module_language($this->language,"\x53\145\162\x76\x69\143e\163");$mod_lang = return_specified_module_language($this->language,"P\x72\157\144\x75\143t\163");}$trans_str = ($mod_lang[$str] != '') ? $mod_lang[$str] : (($app_lang[$str] != '') ? $app_lang[$str] : $str);return $trans_str;}private function x1b() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $inventory_table = $this->inventory_table_array[$this->module];$inventory_id = $this->inventory_id_array[$this->module];$res = $this->db->pquery("S\x45L\105CT\040\x63\x75\x72\162en\143y\137\x69\x64,\x20".$inventory_table.".\x63\x6f\x6e\x76\145\x72s\151\157n\x5f\x72\141\164\x65\040\101S \143\157n\166_\x72\x61\164\x65\054\040\x76\x74\151g\x65\x72\137\x63u\x72\x72en\143y\x5f\x69\x6e\146o\056\052\x0d\012\040 \x20 \x20\x20\x20\040\x20\040\040 \040\040\040         \x20\x20\x20F\x52\117\115\040".$inventory_table."\015\012 \x20 \x20\040\x20\040\x20\x20\x20\040\x20\x20\x20\040\x20\040\040\040\040\040\x20 \040\040\x20\040\x49NNER\040\x4a\117I\x4e\040\x76\164\151g\x65r\x5f\x63\x75\162\x72\145\156\x63y\x5f\151n\146o \117\x4e\040".$inventory_table."\x2e\x63\x75\162\x72en\x63y\x5f\151\144 =\040\166\x74\151\x67\x65\x72\x5f\143\165\162\x72\145\x6e\x63\171\137i\156fo\056i\144
\012\x20\040  \x20\x20\040\040\040\x20   \x20\x20 \x20  \040\x20\040\040\x20\040\x20 W\x48E\x52E ".$inventory_id."\075\077", array($this->focus->id));$currency_info = array();$currency_info["\x63\165\x72\x72\x65n\x63\x79\x5f\x69\x64"] = $this->db->query_result($res,0,"\x63ur\162\145\x6e\x63y\x5fi\144");$currency_info["\143\157\x6e\166e\162s\151o\156\137r\x61\164e"] = $this->db->query_result($res,0,"\143\x6fn\x76_\x72a\164\145");$currency_info["\x63\165rr\x65\156\143y\137n\x61\x6de"] = $this->db->query_result($res,0,"\x63\165\x72r\x65\x6e\143\171\x5f\156\141\155e");$currency_info["curren\143\x79\137c\157\144\145"] = $this->db->query_result($res,0,"\x63u\x72\162e\156\x63\171\x5f\x63\x6fde");$currency_info["cu\162\162\145ncy\137sym\142ol"] = $this->db->query_result($res,0,"\143\165\162r\x65\x6e\143\x79\x5fs\171\x6d\142\x6fl");return $currency_info;}private function x1c() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $res = $this->db->pquery("S\x45\114\105\103\124\x20\164\141x\x74\x79\160\x65\x20\106\x52\x4f\x4d\040".$this->inventory_table_array[$this->module]." \x57\110\x45\x52\x45\x20".$this->inventory_id_array[$this->module]."=\x3f", array($this->focus->id));$taxtype = $this->db->query_result($res,0,'taxtype');return $taxtype;}private function x1d($value) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; if($x17($value)){$number = $x19($value,$this->decimals,$this->decimal_point,$this->thousands_separator);}else {$number = "";}return $number;}private function x1e(&$focus,$record,$module) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $result = Array();foreach($focus->tab_name_index as $table_name=>$index)$result[$table_name] = $this->db->pquery("\x53\105\114\105\x43\124\x20*\x20\x46\122\x4f\115 ".$table_name."\x20\x57H\x45R\105\040".$index."\075\x3f", array($record));$tabid = getTabid($module);$sql1 = "\x53\105L\x45CT\x20\x66i\x65\154d\156a\155e\x2c\x20f\x69\145\154\x64\x69d\x2c fi\x65\x6c\x64\154ab\x65\154,\040c\157l\x75m\156na\155\x65\054\x20\164a\142\x6c\x65\x6eam\145\x2c \165\151ty\x70\x65\054\x20t\x79\160e\157\146da\164a\054 \160\x72\x65s\x65nce
\012\x20  \x20 \x20    \040\040 \x20 \x46\x52\117M\040\x76t\151\147\x65r\137f\151\x65l\144\040\x57H\x45\x52E \x74\x61b\x69\x64\075?";$result1 = $this->db->pquery($sql1, array($tabid));$noofrows = $this->db->num_rows($result1);if($noofrows) {while($resultrow = $this->db->fetch_array($result1)) {$fieldcolname = $resultrow["\143o\154\165\x6dn\x6e\x61\155e"];$tablename= $resultrow["\164\x61\x62\154\145\156\141me"];$fieldname= $resultrow["f\x69\x65\x6c\144\x6e\141\x6de"];$fld_value="";if(isset($result[$tablename]))$fld_value = $this->db->query_result($result[$tablename],0,$fieldcolname);$focus->column_fields[$fieldname] = $fld_value;}}$focus->column_fields["\162e\143\157r\x64_\151\x64"] = $record;$focus->column_fields["r\145\143ord_\155\157d\165l\x65"] = $module;}private function x1f($value) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; if($x10("\155\157du\x6ces/S\145\164\x74in\147\163/\105\144\151t\x54\x65\162m\104\x65\164\x61\x69\x6cs.p\150\x70")) {$sql = "\x53\x45\x4c\x45\103T\x20t\x61\x6edc\x20\x46R\117\x4d vtig\145r_\151\156\166\x65n\x74o\x72y\x5f\x74\141\x6ed\x63\040\127H\x45R\x45\x20\151d\x3d'".$value."'";$res = $this->db->query($sql);$num = $this->db->num_rows($res);if($num>0)$tandc = $this->db->query_result($res,0,"\x74\x61n\144c");else$tandc = $value;}else$tandc = $value;return $tandc;}private function x20($efocus) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $commentlist="";$prefix="";if($efocus->column_fields["\162\x65c\x6f\x72d\x5f\x6d\x6f\x64u\x6ce"] == "\110el\x70\x44esk"){$prefix="ti\143\153\x65\164";}elseif($efocus->column_fields["r\145\143\x6f\x72\x64_\155\x6f\144u\x6c\x65"] == "\106\141\161") {$prefix="faq";}if($prefix!="") {$mod_lang = return_specified_module_language($this->language,$efocus->column_fields["\162ec\x6f\x72d_\155o\144\165\154\145"]);$sql="\x53E\x4cE\103\124 *\040\106\122OM \x76ti\x67er\x5f".$prefix."\143\157\x6d\x6d\145nts WH\x45R\x45\040".$prefix."\x69d=".$efocus->id;$result=$this->db->query($sql);while($row = $this->db->fetchByAssoc($result)) {$comment = $row["c\157\155m\145\x6e\x74\163"];$crtime = getValidDisplayDate($row["c\162\145a\164\x65dt\151\155\145"]);$body="";if($prefix=="ti\x63\x6b\145t"){$author = $this->x18($row["\157w\x6e\x65r\151\144"]);$body=$comment."\x3c\x62r\x20/>".$mod_lang["\x4cBL_\x41\x55T\110O\x52"]."\x3a\x20".$author."\074b\162\x20\057\x3e".$mod_lang["\103\x72e\141\164\x65\144\040\124\151\x6d\x65"].":\x20".$crtime."<\x62\x72 \x2f\x3e\074br\x20/>";}else {$body=$comment."\074\142r\040\x2f>".$mod_lang["Cr\145\x61\164e\144 \x54\151\x6de"].":\040".$crtime."<\142\x72\x20\057><br\040\x2f\076";}$commentlist.=$body;}}return $commentlist;}private function x21($folderid) { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $sql="SEL\x45\103T\040\x66o\x6cde\x72\156\x61m\145\040\106\x52\x4f\115\040\166\164i\x67e\x72\x5f\x61\x74\x74a\x63h\x6d\145nts\146\x6f\154\144\x65\162 \127\x48ERE\x20\x66ol\144\145\162i\144=".$folderid;return $foldername = $this->db->query_result($this->db->query($sql),0,"\x66\157\154\144\145\162\x6e\141\x6de");}public function getFilename() { global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $this->content = $this->filename;$this->replacements["\044\043\x54\105\115\120L\x41\x54E_\x4eA\115E\043\044"]=$this->templatename;$this->replacements["\x24\x23DD-MM\x2d\x59\x59\x59Y#\044"]=$x0e("\144\x2d\155\x2dY");$this->replacements["\044\043\x4d\x4d\x2d\104D-\x59Y\131\131\x23\044"]=$x0e("\x6d\055d\x2dY");$this->replacements["\044#\x59\131\131\x59-\x4dM-\104D\043$"]=$x0e("Y\055\x6d\055d");$this->replacements["\x24".$x20($this->module)."\x5f\x43\x52\115I\x44\044"]=$this->focus->id;$this->x0e($this->module, $this->focus);$this->replacements=array();$this->replacements["\\x72\\156"]="";$this->replacements["\x5cn\134r"]="";$this->replacements["\134\x6e"]="";$this->replacements["\134\162"]="";$this->x12();return $x22(generate_cool_uri($x1e($x13($this->content,ENT_COMPAT,"u\164\146\0558"))),0,255);}}function generate_cool_uri($name){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24; $nazov=$x24($x23($x1f($name)));$Search = array("$","\x80","\046","\x25","\051","\x28","\x2e","\040\055\040","\x2f","\040","\x2c","\046#\x33\061\070\x3b","\x9a","\x26\x23\062\066\x39\073","\x26\043\x33\x35\x37\073","\x9e","","\xe1","\xed","","\363","\366","\x26\0433\066\067;","\372","\374","\344","\x26#\x332\x38\073","\046#2\x37\x31\073","","\046\x23\x33\064\061\x3b","\x26#\063\x31\067;","\x8a","\x26#\x32\x368\073","\046\043\063\x35\066;","\216","\335","\301","\315","\xc9","","","\046\04327\060\x3b","\"","\xb0","");$Replace = array("","","","","","","\x2d","\055","-","-","\055","l","s","c","\164","\172","y","\x61","\x69","\x65","o","\157","u","\165","\165","\x61","\x6e","\x64","o","\x72","\154","\x73","\x63","\164","\172","\x79","\x61","\151","\145","\x6f","\165","\x64","","","\x73\x73");$return=$x1c($Search, $Replace, $name); return $return;}function createPDFAndSaveFile($templates,$focus,$modFocus,$file_name,$moduleName,$language){ global $x0b,$x0c,$x0d,$x0e,$x0f,$x10,$x11,$x12,$x13,$x14,$x15,$x16,$x17,$x18,$x19,$x1a,$x1b,$x1c,$x1d,$x1e,$x1f,$x20,$x21,$x22,$x23,$x24;  $db="\x61db";$cu="\x63\x75\x72\162e\x6e\x74\x5fuse\x72";$dl="d\145\146\x61\165\x6c\164\x5flan\x67\165\x61ge";global $$db, $$cu, $$dl; $date_var = $x0e("\x59\x2dm-d\x20\x48:i\x3a\x73");$ownerid = $focus->column_fields["a\163\163\151\x67\x6e\x65\144\x5f\165\163\145r\x5f\x69d"]; if(!isset($ownerid) || $ownerid=="")$ownerid = $$cu->id; $current_id = $$db->getUniqueID("v\164ig\145\162_\x63\x72m\145n\x74\151\x74\171");$templates = $x1b($templates,";");$Templateids = $x0f("\x3b",$templates);$x16("\155\145\155\157ry\x5f\154\151\155\151\x74","1\062\070\x4d");$name="";if (!$language || $language == "") $language = $$dl;foreach ($Templateids AS $templateid){$PDFContent = new PDFContent($templateid, $moduleName, $modFocus, $language);$pdf_content = $PDFContent->getContent();$Settings = $PDFContent->getSettings();if($name=="")$name = $PDFContent->getFilename();$header_html = $x13($pdf_content["he\x61\x64\145\x72"],ENT_COMPAT,"\x75\164\146\x2d\x38");$body_html = $x13($pdf_content["\x62ody"],ENT_COMPAT,"\x75t\146\055\x38");$footer_html = $x13($pdf_content["fo\x6f\164\145r"],ENT_COMPAT,"\165\164\x66-8");$encoding = $Settings["\145\x6ec\157di\x6e\x67"];if ($Settings["\157\162i\145\156t\141ti\x6f\156"] == "\154a\x6ed\163c\141p\145") $format = $Settings["\146\157\162\155\141\164"]."\055\114";else $format = $Settings["\x66\157rm\141\164"];if (!isset($mpdf)){$mpdf=new mPDF('',$format,'','Arial',$Settings["\x6dar\147i\x6e\137l\x65\146t"],$Settings["\155ar\147\x69n\x5fr\151\147\150t"],0,0,$Settings["\x6d\x61\x72g\x69\156_\x74o\x70"],$Settings["\x6darg\x69n_b\x6f\164\164o\155"]);$mpdf->SetAutoFont();@$mpdf->SetHTMLHeader($header_html);}else{@$mpdf->SetHTMLHeader($header_html);@$mpdf->WriteHTML('<pagebreak sheet-size="'.$format.'" margin-left="'.$Settings["\x6d\x61\162\147\x69n\x5f\x6c\x65f\164"].'mm" margin-right="'.$Settings["\x6da\162\147i\x6e_\162\151\147ht"].'mm" margin-top="0mm" margin-bottom="0mm" margin-header="'.$Settings["\155a\x72\x67\x69\156_\x74\157\160"].'mm" margin-footer="'.$Settings["\155a\162\147in\137\x62\157\164t\x6fm"].'mm" />');}@$mpdf->SetHTMLFooter($footer_html);@$mpdf->WriteHTML($body_html);}$upload_file_path = decideFilePath();if($name!="")$file_name = $name."\x2e\160\144\x66"; $mpdf->Output($upload_file_path.$current_id."_".$file_name);$filesize = $x11($upload_file_path.$current_id."\x5f".$file_name);$filetype = "a\x70\160\154\x69\143\x61ti\x6f\156\057p\x64\x66"; $sql1 = "\x69\156s\x65\x72\164\040\x69\x6eto\x20\166\164\x69g\145\x72\137c\162me\156\x74it\x79\x20\x28\x63\162m\x69d\x2cs\155\x63\x72\x65\141t\x6f\x72\151\144\x2csm\x6f\x77\x6e\145r\x69\144\x2c\x73\145\164\171\160\145,\x64e\x73crip\164\151\x6f\x6e,\143\162\x65\x61\x74\x65\144t\x69\155e\x2c\155o\x64\151f\151\x65\x64\x74\x69m\145)\040\x76\141\154u\x65\163\050\077\x2c\x20\x3f,\x20\077\x2c\x20\077\x2c \x3f\054\x20\077\x2c\040\x3f)"; $params1 = array($current_id, $$cu->id, $ownerid, "\x44o\143u\x6den\x74s A\x74ta\143\x68me\x6e\x74", $focus->column_fields["\x64\145\x73\x63\x72i\160ti\157\x6e"], $$db->formatDate($date_var, true), $$db->formatDate($date_var, true)); $$db->pquery($sql1, $params1); $sql2="insert\x20\151\x6e\164o v\x74ige\x72\137\141\164\164a\x63\x68\x6d\145\x6e\x74s\x28a\x74ta\143\x68me\x6e\x74\163i\x64, \x6e\141m\145\x2c\040\144\145\163\x63\162ip\164i\x6f\x6e\054\x20\164y\x70\x65\054\040p\141\164\150\x29\x20\166\141l\165\x65\x73\050\077,\040\x3f\054\x20\077\054 \077,\x20\x3f)"; $params2 = array($current_id, $file_name, $focus->column_fields["d\x65\x73\x63\x72\x69\160t\x69\157\x6e"], $filetype, $upload_file_path); $result=$$db->pquery($sql2, $params2); $sql3='insert into vtiger_seattachmentsrel values(?,?)'; $$db->pquery($sql3, array($focus->id, $current_id));$sql4="U\120D\101\x54E v\x74\151\x67\x65r\137n\x6f\x74\x65\163\x20\x53\105\x54 f\x69\x6c\145s\151\172\145\075\x3f\x2c\x20\146\x69\154\145n\x61\x6d\145\075\077 W\x48\x45R\105\040\156\157\164\145\163\x69\x64\075\x3f";$$db->pquery($sql4,array($filesize,$file_name,$focus->id)); return true;}
?>